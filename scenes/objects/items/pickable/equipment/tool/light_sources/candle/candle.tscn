[gd_scene load_steps=14 format=2]

[ext_resource path="res://scenes/objects/items/pickable/equipment/tool/tool_item.tscn" type="PackedScene" id=1]
[ext_resource path="res://scenes/objects/items/pickable/equipment/tool/light_sources/candle/fire_origin.gd" type="Script" id=2]
[ext_resource path="res://scenes/objects/items/pickable/equipment/tool/light_sources/candle/candle.gd" type="Script" id=3]
[ext_resource path="res://scenes/objects/items/pickable/MeshInstances.gd" type="Script" id=4]

[sub_resource type="CylinderMesh" id=1]
top_radius = 0.02
bottom_radius = 0.02
height = 0.2
radial_segments = 16
rings = 1

[sub_resource type="Shader" id=8]
code = "shader_type spatial;

const float MAX_EMISSION_STRENGTH = 0.4;
uniform vec4 EMISSION_COLOR : hint_color;
varying float Y_FACTOR;

void vertex() {
	Y_FACTOR = VERTEX.y*5.0 + 0.5;
//	float normal_flip = step(0.5, Y_FACTOR);
	vec3 new_normal = VERTEX;
	new_normal.y *= 0.2;
	NORMAL = new_normal;
}

void fragment() {
	EMISSION = EMISSION_COLOR.rgb*MAX_EMISSION_STRENGTH*pow(Y_FACTOR, 2.0);
}"

[sub_resource type="ShaderMaterial" id=9]
shader = SubResource( 8 )
shader_param/EMISSION_COLOR = Color( 1, 0.713726, 0.411765, 1 )

[sub_resource type="CylinderShape" id=2]
height = 0.2
radius = 0.06

[sub_resource type="CylinderMesh" id=3]
top_radius = 0.0
bottom_radius = 0.015
height = 0.08
radial_segments = 6
rings = 1

[sub_resource type="Shader" id=4]
code = "shader_type spatial;
render_mode blend_add, unshaded;

const vec3 CENTER_OFFSET = vec3(0.0, -0.03, 0.0);
const vec3 SCALE = vec3(50.0, 12.0, 50.0);

uniform float INTENSITY = 1.0;
uniform sampler2D COLOR_RAMP;
varying vec2 XY_FACTOR;

void vertex() {
	vec3 v = (VERTEX - CENTER_OFFSET)*SCALE;
	XY_FACTOR = vec2(v.x*v.x + v.z*v.z, v.y);
}

void fragment() {
	ALBEDO.rgb = texture(COLOR_RAMP, vec2(XY_FACTOR.y)).rgb*INTENSITY;
}"

[sub_resource type="Gradient" id=5]
offsets = PoolRealArray( 0, 0.10559, 0.223602, 0.360248, 0.428571, 0.453416, 0.819876 )
colors = PoolColorArray( 0, 0, 0, 1, 0, 0.0495, 0.09, 1, 0.09, 0.07584, 0.0369, 1, 0.879811, 0.50184, 0.00487359, 1, 1, 0.566667, 0, 1, 0.51, 0.1275, 0, 1, 0.19, 0, 0, 1 )

[sub_resource type="GradientTexture" id=6]
gradient = SubResource( 5 )
width = 32

[sub_resource type="ShaderMaterial" id=7]
shader = SubResource( 4 )
shader_param/INTENSITY = 4.0
shader_param/COLOR_RAMP = SubResource( 6 )

[node name="Candle" instance=ExtResource( 1 )]
script = ExtResource( 3 )
item_name = "Candle"

[node name="MeshInstance" parent="." index="0"]
cast_shadow = 2
mesh = SubResource( 1 )
material/0 = SubResource( 9 )

[node name="CollisionShape" parent="." index="1"]
shape = SubResource( 2 )

[node name="FireOrigin" type="Position3D" parent="." index="2"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.10956, 0 )
script = ExtResource( 2 )

[node name="Fire" type="MeshInstance" parent="FireOrigin" index="0"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.03, 0 )
cast_shadow = 0
mesh = SubResource( 3 )
skeleton = NodePath("../..")
material/0 = SubResource( 7 )
script = ExtResource( 4 )
main_parent = NodePath("../..")

[node name="Light" type="OmniLight" parent="FireOrigin/Fire" index="0"]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.000501111, 0 )
light_color = Color( 1, 0.713726, 0.411765, 1 )
shadow_enabled = true
omni_range = 14.9623
omni_attenuation = 4.0

[node name="Durability" type="Timer" parent="." index="4"]
wait_time = 900.0
one_shot = true

[connection signal="timeout" from="Durability" to="." method="_on_Durability_timeout"]
