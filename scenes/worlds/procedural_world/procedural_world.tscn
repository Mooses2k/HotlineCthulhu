[gd_scene load_steps=20 format=2]

[ext_resource path="res://scenes/worlds/game_world.tscn" type="PackedScene" id=1]
[ext_resource path="res://scenes/worlds/procedural_world/procedural_world.gd" type="Script" id=2]
[ext_resource path="res://scenes/worlds/world_gen/generation_steps/generate_room_graph.gd" type="Script" id=3]
[ext_resource path="res://scenes/worlds/world_gen/generation_steps/generate_room_pillars.gd" type="Script" id=4]
[ext_resource path="res://resources/mesh_libraries/modular_pieces.meshlib" type="MeshLibrary" id=5]
[ext_resource path="res://scenes/characters/cultists/neophyte.tscn" type="PackedScene" id=6]
[ext_resource path="res://scenes/objects/pickable_items/equipment/tool/light-sources/omnidirectional_lantern/omni_lantern.tscn" type="PackedScene" id=7]
[ext_resource path="res://scenes/worlds/procedural_world/initial_loot_list.tres" type="Resource" id=8]
[ext_resource path="res://scenes/worlds/procedural_world/character_spawner.gd" type="Script" id=9]
[ext_resource path="res://scenes/worlds/world_gen/generation_steps/generation_group.gd" type="Script" id=10]
[ext_resource path="res://scenes/worlds/world_gen/generation_steps/populate_room/generate_candelabra.gd" type="Script" id=11]
[ext_resource path="res://scenes/worlds/world_gen/generation_steps/populate_room/candelabra_spawn_list.tres" type="Resource" id=12]
[ext_resource path="res://scenes/worlds/procedural_world/item_spawner.gd" type="Script" id=16]
[ext_resource path="res://scenes/worlds/world_gen/generation_steps/generate_rooms.gd" type="Script" id=17]
[ext_resource path="res://scenes/worlds/world_gen/generation_steps/generate_walls.gd" type="Script" id=18]
[ext_resource path="res://scenes/worlds/world_gen/generation_steps/generate_halls.gd" type="Script" id=19]
[ext_resource path="res://scenes/worlds/world_gen/generation_steps/generate_corridors.gd" type="Script" id=20]
[ext_resource path="res://scenes/worlds/world_gen/generation_steps/generate_grid_tiles.gd" type="Script" id=21]

[sub_resource type="SpatialMaterial" id=3]
flags_unshaded = true
vertex_color_use_as_albedo = true

[node name="ProceduralWorld" instance=ExtResource( 1 )]
script = ExtResource( 2 )

[node name="Gridmaps" parent="." index="0"]
mesh_library = ExtResource( 5 )

[node name="DirectionalLight" parent="." index="2"]
visible = false
light_energy = 0.5
shadow_bias = 0.05
directional_shadow_normal_bias = 0.2

[node name="Navigation" parent="." index="4"]
preview_material = SubResource( 3 )

[node name="CharacterSpawner" type="Node" parent="." index="5"]
script = ExtResource( 9 )
character_scene = ExtResource( 6 )
max_count = 3
_density_by_type = {
2: 0.02,
3: 0.0025,
4: 0.005
}

[node name="GenerateRooms" type="Node" parent="GenerationManager" index="0"]
script = ExtResource( 17 )
room_size_max = 3

[node name="GenerateRoomGraph" type="Node" parent="GenerationManager" index="1"]
script = ExtResource( 3 )

[node name="GenerateCorridors" type="Node" parent="GenerationManager" index="2"]
script = ExtResource( 20 )

[node name="GenerateHalls" type="Node" parent="GenerationManager" index="3"]
script = ExtResource( 19 )

[node name="GenerateWalls" type="Node" parent="GenerationManager" index="4"]
script = ExtResource( 18 )

[node name="GenerateRoomPillars" type="Node" parent="GenerationManager" index="5"]
script = ExtResource( 4 )
pillar_tile = 16

[node name="GenerateGridTiles" type="Node" parent="GenerationManager" index="6"]
script = ExtResource( 21 )
floor_tile = 6
wall_tile = 5
door_tile = 19
double_door_tile = 14
ceiling_tile = 10
pillar_room_double_wall_tile = 3
pillar_room_double_door_tile = 1
pillar_room_double_ceiling_tile = 18
pillar_room_double_floor_tile = 7
pillar_room_pillar_tile = 15
pillar_tile = 16

[node name="PopulateRooms" type="Node" parent="GenerationManager" index="7"]
script = ExtResource( 10 )

[node name="IlluminationGroup" type="Node" parent="GenerationManager/PopulateRooms" index="0"]
script = ExtResource( 10 )

[node name="GenerateCandelabra" type="Node" parent="GenerationManager/PopulateRooms/IlluminationGroup" index="0"]
script = ExtResource( 11 )
_spawn_list_resource = ExtResource( 12 )

[node name="ItemSpawner" type="Node" parent="." index="7"]
script = ExtResource( 16 )
starting_light = ExtResource( 7 )
_loot_list_resource = ExtResource( 8 )
_min_loot = 10
_max_loot = 15

[connection signal="generation_finished" from="." to="CharacterSpawner" method="_on_ProceduralWorld_generation_finished"]
[connection signal="generation_finished" from="." to="ItemSpawner" method="_on_ProceduralWorld_generation_finished"]
